## 카프카 브로커 클러스터 주키퍼

- Brocker: 카프카 클라이언트와 데이터를 주고받기 위해 사용하는 주체이자, 데이터를 분산저장하여 장애가 발생하더라도 안전하게 사용할 수 있도록 도와주는 애플리케이션

- Cluster: 3개이상의 브로커 서버를 1개의 클러스터로 묶어 안전하게 분산 저장

---

## 여러개의 카프카 클러스터가 연결된 주키퍼

- Zookeeper: 카프카 클러스터를 실행하기 위한 애플리케이션

---

## 브로커의 역할

- 컨트롤러: 
  - 클러스터의 다수 브로커 중 한 대가 컨트롤러의 역할을 함
  - 컨트롤러 브로커의 상태를 체크하고 리더 파팃견을 재분배

- 데이터 삭제:
  - 브로커만이 삭제권한을 가짐
  - 컨슈머가 데이터를 가져가더라도 데이터가 삭제되지 않음
  - 데이터 삭제는 파일 단위(로그 세그먼트)로 이루어짐

- 컨슈머 오프셋 저장:
  - 컨슈머 그룹은 토픽이 특정 파티션으로부터 데이터를 가져가서 처리하고 이 파티션의 어느 레코드 까지 가져갔는지 확인하기 위해 오프셋을 커밋한다. 

- 그룹 코디네이터:
  - 컨슈머 그룹의 상태를 체크함
  - 파티션을 컨슈머에 알맞게 분배(컨슈머 리밸러스)

- 데이터의 저장:

  - config/server.properties의 log.dir 옵션에 정의한 디렉토리에 데이터 저장

  - 토픽 이름과 파티션 번호의 조합으로 하위 디렉토리 생성

    



